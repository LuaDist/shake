#!/usr/bin/env lua
-------------------------------------------------------------------------------
-- Command line runner for Shake
--
-- Authors: Andre Carregal, Humberto dos Anjos
-- Copyright (c) 2007 Kepler Project
--
-- $Id: shake,v 1.3 2007/10/25 23:13:42 carregal Exp $
-------------------------------------------------------------------------------

require"shake"

local default = "test.lua"
local filename = arg[1] or default

local run = shake.runner()

local function _iterate(path, testfile)
    for dir in lfs.dir(".") do
        local attr = lfs.attributes (dir)
        if attr.mode == "directory" and dir ~= "." and dir ~= ".." then
            lfs.chdir(dir)
            if io.open(testfile) then
                run:test(testfile, dir)
            else
                _iterate(path.."/"..dir)
            end
            lfs.chdir("..")
        end
    end
end

print("Running tests...\n")

if io.open(filename) then
    run:test(filename)
else
    _iterate("", default)
end

print(run:summary())