#!/usr/bin/env lua
-------------------------------------------------------------------------------
-- Command line runner for Shake
--
-- Authors: Andre Carregal
-- Copyright (c) 2007 Kepler Project
--
-- $Id: shake,v 1.2 2007/10/24 23:41:04 carregal Exp $
-------------------------------------------------------------------------------

require"shake"
require"lfs"

local recursive = (arg[1] == "-tree" or arg[1] == "--tree" or arg[1] == "-t")

local filename = recursive and (arg[2] or "test.lua") or (arg[1] or "test.lua")

local run = shake.runner()

print("Running tests...\n")

if not recursive then
    run:test(filename)
else
    for file in lfs.dir(".") do
        local attr = lfs.attributes (file)
        if attr.mode == "directory" and file ~= "." and file ~= ".." then
            lfs.chdir(file)
            run:test(filename, file)
            lfs.chdir("..")
        end
    end
end

print(run:summary())